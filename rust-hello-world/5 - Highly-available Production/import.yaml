project:
  name: rust-hello-world-ha-production
  # corePackage: SERIOUS allocates dedicated physical infrastructure to ensure
  # consistent latency and throughput by eliminating noisy-neighbor effects.
  corePackage: SERIOUS

services:
  # High-availability production service with dedicated CPU.
  # minContainers: 2 ensures zero-downtime deployments. 
  # cpuMode: DEDICATED reserves CPU cores exclusively for this service.
  - hostname: app
    type: rust@stable
    zeropsSetup: prod
    buildFromGit: https://github.com/zerops-recipe-apps/rust-hello-world-app
    enableSubdomainAccess: true
    minContainers: 2
    maxContainers: 10
    cpuMode: DEDICATED
    verticalAutoscaling:
      minRam: 0.5
      minFreeRamGB: 0.25
    # Note: minFreeRamGB provides headroom against OOM kills during 
    # connection bursts and high-traffic periods.

  # Highly-available PostgreSQL with streaming replication.
  # HA mode survives single-node failure without data loss. 
  # Priority 10 ensures the database is ready before app containers start.
  - hostname: db
    type: postgresql@17
    mode: HA
    priority: 10
    cpuMode: DEDICATED
    verticalAutoscaling:
      minRam: 1